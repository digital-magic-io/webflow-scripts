{"mappings":"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","sources":["src/index.ts","src/form.ts","src/dom.ts","src/fetch.ts","src/utils.ts"],"sourcesContent":["import type { ButtonConfig, Config, FormConfig, PageContext } from './config'\nimport type { FailedValidationType, FormErrorMessages } from './types'\nimport type { DmForm } from './form'\nimport { createForm } from './form'\n\nexport { getTyped as apiGet, postTyped as apiPost, uploadTypedFileList as apiUploadFileList } from './fetch'\n\nconst setupForm = <T extends string>(\n  ctx: PageContext<T>,\n  formName: T,\n  formConfig: FormConfig<T>,\n  globalErrorMessages: FormErrorMessages\n): DmForm<T> => {\n  console.debug('Form:', formName, formConfig)\n  const form = createForm(formConfig.selector, formName, { ...globalErrorMessages, ...formConfig.errorMessages })\n  form.setOnSubmit(() => {\n    console.log('Form submitted:', formName, form.fields)\n    formConfig.onSubmit(form.getFormValues(), ctx)\n  })\n  form.el.setAttribute('novalidate', 'true')\n  return form\n}\n\nconst defaultErrors: Record<FailedValidationType, string> = {\n  required: 'This field is required',\n  minlength: 'Field length is too small',\n  maxlength: 'Field length is too big',\n  pattern: 'Field does not match the pattern',\n  min: 'Field value is too small',\n  max: 'Field value is too big'\n}\n\nexport const init = <F extends string, B extends string>(conf: Config<F, B>): void => {\n  console.log('Initializing...', conf)\n\n  const ctx: PageContext<F> = {\n    forms: {}\n  } as PageContext<F>\n\n  if (conf.forms) {\n    // TODO: Update foreach to map or reduce\n    Object.entries<FormConfig<F>>(conf.forms).forEach(([formName, formConfig]) => {\n      ctx.forms[formName as F] = setupForm<F>(\n        ctx,\n        formName as F,\n        formConfig,\n        conf.errorMessages ?? defaultErrors\n      ) satisfies DmForm<F>\n    })\n    if (conf.buttons) {\n      Object.entries<ButtonConfig<F>>(conf.buttons).forEach(([, buttonConfig]) => {\n        const button: HTMLElement | null = document.querySelector(buttonConfig.selector)\n        if (button) {\n          button.addEventListener('click', () => buttonConfig.onClick(ctx))\n        } else {\n          console.error('Button not found by selector:', buttonConfig.selector)\n        }\n      })\n    }\n\n    console.log('Initialized with context: ', ctx)\n  }\n}\n","import type { FN, FormErrorMessages, Handler, Validator } from './types'\nimport { getElement, getFormElement, getInputElement, setupFormHandler } from './dom'\n\nclass FormError extends Error {\n  parent?: HTMLElement\n\n  constructor(message: string, parent?: HTMLElement) {\n    super(message)\n    Object.setPrototypeOf(this, new.target.prototype)\n    this.parent = parent\n  }\n\n  public toString(): string {\n    return this.message + ' Parent: [' + JSON.stringify(parent) + ']'\n  }\n}\n\ntype DmElement<T extends HTMLElement> = {\n  el: T\n}\n\nexport type DmField = DmElement<HTMLElement> & {\n  input: DmElement<HTMLInputElement>\n  error: DmElement<HTMLElement>\n  validator: Validator\n  clearError: Handler<void>\n  setError: Handler<string>\n  // TODO: Value may be string | number\n  setInputValue: Handler<string>\n}\n\nexport type DmForm<T extends string> = DmElement<HTMLElement> & {\n  fields: Record<T, DmField>\n  error: DmElement<HTMLElement>\n  clearError: Handler<void>\n  clearAllErrors: Handler<void>\n  setError: Handler<string>\n  // TODO: Value may be string | number\n  getFormValues: FN<void, Record<T, string>>\n  setFormValues: Handler<Record<T, string>>\n  setOnSubmit: (handler: (e: Event) => void) => void\n}\n\nconst scanFormFieldNames = (formElement: HTMLFormElement): ReadonlyArray<string> => {\n  // TODO: Field selector must be configurable\n  const formFieldElements = formElement.querySelectorAll('[data-dm-type=\"control\"]')\n  return Array.from(formFieldElements.values())\n    .map((el) => el.getAttribute('data-dm-name'))\n    .filter((name): name is string => !!name)\n}\n\nconst createFormError = (formElement: HTMLFormElement): HTMLElement => {\n  // TODO: Error selector must be configurable\n  const element = getElement('[data-dm-name=\"form_error\"]', formElement)\n  if (!element) {\n    throw new FormError('Form error element not found for form', formElement)\n  }\n  return element\n}\n\nconst createFieldInput = (fieldElement: HTMLElement): HTMLInputElement => {\n  // TODO: Field input selector must be configurable\n  const element = getInputElement('[data-dm-type=\"input\"]', fieldElement)\n  if (!element) {\n    throw new FormError('Form input element not found for: ', fieldElement)\n  }\n  return element\n}\n\nconst createFieldError = (fieldElement: HTMLElement): HTMLElement => {\n  // TODO: Field error selector must be configurable\n  const element = getElement('[data-dm-type=\"error\"]', fieldElement)\n  if (!element) {\n    throw new FormError('Form error element not found for: ', fieldElement)\n  }\n  return element\n}\n\nconst createFieldValidation = (inputElement: HTMLInputElement): Validator => {\n  const required = inputElement.hasAttribute('required')\n  const minLength = inputElement.getAttribute('minlength')\n  const maxLength = inputElement.getAttribute('maxlength')\n  const pattern = inputElement.getAttribute('pattern')\n  const min = inputElement.getAttribute('min')\n  const max = inputElement.getAttribute('max')\n\n  return (value) => {\n    if (required && !value) {\n      return 'required'\n    }\n    if (minLength && String(value).length < Number(minLength)) {\n      return 'minlength'\n    }\n    if (maxLength && String(value).length > Number(maxLength)) {\n      return 'maxlength'\n    }\n    if (pattern && !new RegExp(pattern).test(String(value))) {\n      return 'pattern'\n    }\n    if (min && Number(value) < Number(min)) {\n      return 'min'\n    }\n    if (max && Number(value) > Number(max)) {\n      return 'max'\n    }\n    return true\n  }\n}\n\nconst createFormField = (formElement: HTMLFormElement, name: string): DmField => {\n  // TODO: Field selector must be configurable\n  const fieldElement = getElement(`[data-dm-name=\"${name}\"]`, formElement)\n  if (!fieldElement) {\n    throw new FormError('Form field element not found by name: \"' + name, formElement)\n  }\n  const inputElement = createFieldInput(fieldElement)\n  const errorElement = createFieldError(fieldElement)\n  const validator: Validator = createFieldValidation(inputElement)\n\n  return {\n    el: fieldElement,\n    input: { el: inputElement },\n    error: { el: errorElement },\n    validator: validator,\n    clearError: () => (errorElement.textContent = ''),\n    setError: (error: string) => (errorElement.textContent = error),\n    setInputValue: (value: string) => (inputElement.value = value)\n  } satisfies DmField\n}\n\nexport const createForm = <T extends string>(\n  selector: string,\n  formName: T,\n  formErrorMessages: FormErrorMessages\n): DmForm<T> => {\n  console.debug('Creating form:', formName, selector)\n  const formElement = getFormElement(selector)\n  if (!formElement) {\n    throw new Error('Form element not found by selector: ' + selector)\n  }\n\n  // TODO: Must be optional!\n  const formErrorElement = createFormError(formElement)\n\n  const fieldNames = scanFormFieldNames(formElement)\n  console.debug('Fields scanned:', fieldNames)\n\n  const fieldElements: Record<string, DmField> = fieldNames\n    .map((name) => createFormField(formElement, name))\n    .reduce((acc, cur) => ({ ...acc, [cur.input.el.name]: cur }), {})\n\n  const getFormValues = (): Record<T, string> =>\n    Object.entries<DmField>(fieldElements)\n      .filter(([, instance]) => !!instance && instance.input.el.value.trim().length > 0)\n      .map(([name, instance]) => ({ [name]: instance.input.el.value }))\n      .reduce((acc, cur) => ({ ...acc, ...cur }), {}) as Record<T, string>\n\n  const setFormValues = (values: Record<T, string>): void => {\n    Object.entries<string>(values).forEach(([name, value]) => {\n      if (fieldElements[name]) {\n        fieldElements[name].setInputValue(value)\n      }\n    })\n  }\n\n  const setOnSubmit = (handler: (e: Event) => void): void =>\n    setupFormHandler(formElement, (e) => {\n      const errors = Object.entries(fieldElements)\n        .map(([name, field]) => ({ [name]: field.validator(field.input.el.value) }))\n        .reduce((acc, cur) => ({ ...acc, ...cur }), {})\n      const hasErrors = Object.values(errors).some((error) => error !== true)\n      if (hasErrors) {\n        console.error('Validation errors', errors)\n        Object.entries(errors).forEach(([name, error]) => {\n          if (error !== true) {\n            fieldElements[name].setError(formErrorMessages[error])\n          }\n        })\n        //formErrorElement.textContent = 'Form has errors!'\n      } else {\n        handler(e)\n      }\n    })\n\n  return {\n    el: formElement,\n    fields: fieldElements,\n    error: { el: formErrorElement },\n    clearError: () => (formErrorElement.textContent = ''),\n    clearAllErrors: () => {\n      formErrorElement.textContent = ''\n      Object.values(fieldElements).forEach((field) => field.clearError())\n    },\n    setError: (error: string) => (formErrorElement.textContent = error),\n    getFormValues,\n    setFormValues,\n    setOnSubmit\n  }\n}\n","export const getElement = <T extends HTMLElement = HTMLElement>(\n  selector: string,\n  parent?: HTMLElement\n): T | undefined => {\n  const el: HTMLElement | null = (parent ?? document).querySelector(selector)\n  if (el === null) {\n    console.error(`Element not found by selector: ${parent ? 'parent' : 'document'}.${selector}.`)\n    return undefined\n  } else {\n    return el as T\n  }\n}\n\nexport const getFormElement = (selector: string): HTMLFormElement | undefined => getElement<HTMLFormElement>(selector)\n\nexport const getInputElement = (selector: string, parent?: HTMLElement): HTMLInputElement | undefined =>\n  getElement<HTMLInputElement>(selector, parent)\n\nexport const setupFormHandler = (form: HTMLFormElement, handler: (e: Event) => void): void => {\n  form.action = ''\n  form.method = ''\n  form.onsubmit = (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n  }\n  // TODO: Remove all event listeners\n  form.addEventListener('submit', handler)\n}\n","import type { FN, Handler, NullableType } from './types'\nimport { hasValue } from './utils'\n\nexport const fetchTyped = async <T>(url: string, init: RequestInit = { method: 'GET' }): Promise<T> => {\n  const response = await fetch(url, init)\n  if (!response.ok) {\n    throw new Error(`Failed to fetch ${init.method} ${url}: ${response.status} ${response.statusText}`)\n  } else {\n    const responseText = await response.text()\n    if (!responseText || responseText.length === 0) {\n      return undefined as unknown as Promise<T>\n    } else {\n      return JSON.parse(responseText) as Promise<T>\n    }\n  }\n}\n\nexport const getTyped = async <T>(url: string): Promise<T> => fetchTyped(url)\n\nexport const postTyped = async <T, R>(url: string, body: T): Promise<R> =>\n  fetchTyped(url, {\n    method: 'POST',\n    body: JSON.stringify(body),\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  })\n\nexport const uploadTyped =\n  <R>(url: string) =>\n  (file: File): Promise<R> => {\n    const data = new FormData()\n    data.append('file', file)\n\n    return fetchTyped<R>(url, {\n      method: 'POST',\n      body: data\n    })\n  }\n\nexport const fromFileList = (files: NullableType<FileList>): Array<File> => {\n  const result: Array<File> = []\n  if (hasValue(files)) {\n    for (const file of files) {\n      result.push(file)\n    }\n  }\n  return result\n}\n\nexport const uploadFilesList =\n  <TUploadResult>(\n    upload: FN<File, Promise<TUploadResult>>,\n    onFileUploadSuccess?: Handler<void>,\n    onFileUploadError?: Handler<unknown>\n  ): FN<Array<File>, Promise<Array<TUploadResult>>> =>\n  (files) =>\n    Promise.all(\n      files.map((file) =>\n        upload(file)\n          .then((result) => {\n            onFileUploadSuccess?.()\n            return result\n          })\n          .catch((e: unknown) => {\n            // eslint-disable-next-line no-console\n            console.error('File upload error', e)\n            onFileUploadError?.(e)\n            return undefined\n          })\n      )\n    ).then((result) => result.filter(hasValue))\n\nexport const uploadTypedArray = <R>(url: string, files: Array<File>): Promise<Array<R>> =>\n  uploadFilesList<R>(uploadTyped<R>(url))(files)\n\nexport const uploadTypedFileList = <R>(url: string, files: FileList): Promise<Array<R>> =>\n  uploadTypedArray<R>(url, fromFileList(files))\n","import type { NullableType } from './types'\n\nexport const isEmpty = <T>(value: NullableType<T>): value is null | undefined => value === null || value === undefined\nexport const hasValue = <T>(value: NullableType<T>): value is T => !isEmpty(value)\n"],"names":[],"version":3,"file":"main.js.map"}