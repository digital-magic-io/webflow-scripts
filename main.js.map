{"mappings":"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","sources":["src/index.ts","src/api.ts","src/wfdom.ts"],"sourcesContent":["import { apiGetCar, apiGetClient, apiPostClient, ClientPersonalData } from './api'\nimport { getInput, setErrorMsg, setInput, setupFormHandler } from './wfdom'\nimport { WfConfiguration } from './wfconfig'\n\nconst handleSubmitClient =\n  (stepper: WfConfiguration['stepper'], f: WfConfiguration['elements']['stepClient']) =>\n  (e: Event): void => {\n    console.log('Form submitted', e.target)\n    const client: ClientPersonalData = {\n      formType: 'BUYOUT',\n      name: getInput(f.txtName)?.value ?? '',\n      email: getInput(f.txtEmail)?.value ?? '',\n      phoneNumber: getInput(f.txtPhone)?.value ?? '',\n      language: 'et'\n    }\n    if (client.name && client.email && client.phoneNumber) {\n      void apiPostClient(client)\n        .then(() => {\n          stepper.nextStepFn(1)\n        })\n        .catch((error) => {\n          console.error('API error:', error)\n          setErrorMsg(f.msgError, 'Unable to send client data!')\n        })\n    } else {\n      setErrorMsg(f.msgError, 'All fields must be filled!')\n    }\n  }\n\nconst handleSubmitSearchVehicle =\n  (f: WfConfiguration['elements']['stepVehicle']) =>\n  (e: Event): void => {\n    console.log('Form submitted', e.target)\n    const plateNumber = getInput(f.plateNumber.txtPlateNumber)?.value\n    if (plateNumber && plateNumber.length > 0) {\n      console.log('Plate number:', plateNumber)\n      apiGetCar(plateNumber)\n        .then((response) => {\n          console.log('Car response:', response)\n          setInput(f.txtMake, response.mark)\n          setInput(f.txtModel, response.model)\n        })\n        .catch((error) => {\n          console.error('Car error:', error)\n          setErrorMsg(f.plateNumber.msgError, 'Car not found!')\n        })\n    } else {\n      setErrorMsg(f.plateNumber.msgError, 'Plate number must be filled!')\n    }\n  }\n\nconst handleSubmitVehicle =\n  (f: WfConfiguration['elements']['stepVehicle']) =>\n  (e: Event): void => {\n    console.log('Form submitted', e.target)\n    const make = getInput(f.txtMake)?.value\n    const model = getInput(f.txtModel)?.value\n    if (make && model) {\n      console.log(`Submitted: make=${make}, model=${model}`)\n    } else {\n      setErrorMsg(f.msgError, 'Make and model must be filled!')\n    }\n  }\n\nexport const init = (conf: WfConfiguration): void => {\n  console.log('Initializing...', conf)\n  void apiGetClient().then((client) => {\n    console.log('Client', client)\n    setupFormHandler(conf.elements.stepClient.form, handleSubmitClient(conf.stepper, conf.elements.stepClient))\n    setupFormHandler(conf.elements.stepVehicle.plateNumber.form, handleSubmitSearchVehicle(conf.elements.stepVehicle))\n    setupFormHandler(conf.elements.stepVehicle.form, handleSubmitVehicle(conf.elements.stepVehicle))\n  })\n\n  //dom.setupFormHandler(conf.stepVehicle, handleSubmitSearch(dom))\n  //dom.setupFormHandler(idFormVehicle, handleSubmitVehicle(dom))\n}\n","type Language = 'et' | 'ru' | 'en'\n\ntype FormType = 'BUYOUT'\n\nexport type ClientPersonalData = {\n  formType: FormType\n  name: string\n  email: string\n  phoneNumber: string\n  language: Language\n}\n\nexport type VehicleMntSearchResponse = {\n  engine?: {\n    type: 'FUELS'\n    value: number\n  }\n  engineVolCm3?: number\n  engineKw?: number\n  firstRegYear?: number\n  mark: string\n  model: string\n  nextInspectionDate?: string\n  transmission?: {\n    type: 'TRANSMISSIONS'\n    value: number\n  }\n  registrationNumber?: string\n}\n\nconst lookupCarRegistryUrl = (plateNumber: string): string => `https://test.carprof.ee/api/v1/cars/mnt/${plateNumber}`\nconst clientUrl = 'https://test.carprof.ee/api/v1/forms/client'\n\nconst fetchTyped = async <T>(url: string, init: RequestInit = { method: 'GET' }): Promise<T> => {\n  const response = await fetch(url, init)\n  if (!response.ok) {\n    throw new Error(`Failed to fetch ${init.method} ${url}: ${response.status} ${response.statusText}`)\n  } else {\n    const responseText = await response.text()\n    if (!responseText || responseText.length === 0) {\n      return undefined as unknown as Promise<T>\n    } else {\n      return JSON.parse(responseText) as Promise<T>\n    }\n  }\n}\n\nconst getTyped = async <T>(url: string): Promise<T> => fetchTyped(url)\nconst postTyped = async <T, R>(url: string, body: T): Promise<R> =>\n  fetchTyped(url, {\n    method: 'POST',\n    body: JSON.stringify(body),\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  })\n\nexport const apiGetCar = (plateNumber: string): Promise<VehicleMntSearchResponse> =>\n  getTyped(lookupCarRegistryUrl(plateNumber))\n\nexport const apiGetClient = (): Promise<ClientPersonalData> => getTyped(clientUrl)\nexport const apiPostClient = (client: ClientPersonalData): Promise<Response> => postTyped(clientUrl, client)\n","export const getElement = <T extends HTMLElement>(path: string): T | undefined => {\n  const el: HTMLElement | null = document.querySelector(path)\n  if (el === null) {\n    console.error(`Element not found by path: ${path}.`)\n    return undefined\n  } else {\n    return el as T\n  }\n}\nexport const getInput = (path: string): HTMLInputElement | undefined => getElement<HTMLInputElement>(path)\nexport const setInput = (path: string, value: string): void => {\n  const input = getInput(path)\n  if (input) {\n    input.value = value\n  }\n}\n\nexport const getForm = (path: string): HTMLFormElement | undefined => getElement<HTMLFormElement>(path)\n\nexport const setErrorMsg = (path: string, msg: string): void => {\n  const el = getElement(path)\n  if (el) {\n    el.innerHTML = msg\n  }\n}\n\nexport const setupFormHandler = (path: string, handler: (e: Event) => void): void => {\n  const form = getForm(path)\n  if (form) {\n    form.action = ''\n    form.method = ''\n    form.onsubmit = (e) => {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n    // TODO: Remove all event listeners\n    form.addEventListener('submit', handler)\n  } else {\n    console.error(`Unable to find form with id \"${path}\"`)\n  }\n}\n\nexport const setupBtnHandler = (path: string, handler: (e: Event) => void): void => {\n  const btn = getElement<HTMLButtonElement>(path)\n  if (btn) {\n    btn.onclick = handler\n  } else {\n    console.error(`Unable to find button with id \"${path}\"`)\n  }\n}\n"],"names":[],"version":3,"file":"main.js.map"}